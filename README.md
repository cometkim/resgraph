# ResGraph

Build GraphQL servers in ReScript.

> Spiritual sibling project to [Grats](https://github.com/captbaritone/grats), from which this project derives most of its ideas, reimplemented in the ReScript ecosystem instead.

## Introduction

ResGraph lets you build _implementation first_ GraphQL servers, where your types and code is the source of truth for the schema.

## Development notes

This is a heavy work-in-progess. The repo itself was originally forked from the ReScript editor tooling, which means that there's a ton of stuff lying around that aren't really used. This will be cleaned up later.

### Local development

First, set up OCaml.

```bash
# If you haven't created the switch, do it. OPAM(https://opam.ocaml.org)
opam switch 4.14.0 # can also create local switch with opam switch create . 4.14.0

# Install dev dependencies from OPAM
opam install . --deps-only

# For IDE support, install the OCaml language server
opam install ocaml-lsp-server
```

Then, install JS dependencies:

```bash
npm i
```

Now, you can build `ResGraph` and run its tests:

```bash
# You might need to run this twice the first time
make test
```

Accompanied with the tests is a simple test server that'll let you run GraphiQL to execute operations against the test schema. Start it by running:

```bash
npm run watch-testapp
```

This will start the test server and watch for changes so it's restarted with any change. You can now access GraphiQL at http://localhost:9898/graphql.
The test server will also dump an up to date `schema.graphql` on restart, so you'll be able to see how any changes you make affect the schema.

For the best experience, also run the ReScript compiler as a separate process:

```bash
npx rescript build -w
```

The workflow after this is setup is roughly:

1. Make changes to the test schema (primarily located in `Schema.res`)
2. Run `ResGraph` via `make test`
3. Test the changes in GraphiQL, or see them in `schema.graphql`

## High level overview of how ResGraph works

1. You write your types and code in ReScript, and annotate them with attributes to expose them via GraphQL.
2. ResGraph runs after the ReScript compiler has recompiled, and scans your project for all GraphQL-related things. It then extracts all relevant GraphQL things from the compiled type information.
3. What it finds is then transformed into an actual `graphql-js` schema that you can run.

ResGraph is _fast_, because it's leveraging the standard ReScript tooling, and using OCaml.

## Documentation

- General approach to inference
- Valid GraphQL types
- Object types
  - Definition
  - Interfaces
  - Exposing fields as-is with `@gql.field`
- Enums
  - Definition
  - Rules
  - Returning an enum
- Unions
  - Definition
  - Rules
  - Returning a union
  - Advanced: Autogenerated `resolveType`
- Interfaces
  - Definition
  - Rules
  - Having an interface as a field type
  - Advanced: Autogenerated `resolveType`
- Resolvers (fields)
- Validations and editor integration
  - Own LSP (?)
- Relay integration
  - Node interface
  - Connections
- Integrating with the wider ecosystem
